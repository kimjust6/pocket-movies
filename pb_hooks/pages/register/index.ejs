<script server>
    let error = null
    console.log('Processing request method:', request.method)
    if (request.method === 'POST') {
        const provider = body().provider
        console.log('Provider:', provider)
        if (provider) {
            try {
                // Disable autoRedirect so we can handle it explicitly
                const url = requestOAuth2Login(provider, {
                    redirectPath: '/auth/oauth/redirect',
                    autoRedirect: false
                })
                console.log('Redirecting to:', url)
                redirect(url)
            } catch (e) {
                console.error('Login error:', e)
                error = e.message
            }
        }
    }
</script>

<div class="relative min-h-[calc(100vh-64px)] overflow-hidden">
    <!-- Background Effects -->
    <div class="absolute inset-0 bg-gradient-to-br from-primary/10 via-base-100 to-secondary/10">
        <!-- Grid Pattern -->
        <div
            class="absolute inset-0 bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px]">
        </div>
        <!-- Radial Gradient Overlay -->
        <div class="absolute inset-0 bg-gradient-to-t from-base-100 via-base-100/50 to-transparent"></div>
        <!-- Cinematic Glow -->
        <div
            class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-primary/20 rounded-full blur-[120px] opacity-40 animate-pulse">
        </div>
    </div>

    <div class="hero relative z-10 min-h-[calc(100vh-64px)]">
        <div class="hero-content flex-col text-center">
            <div class="max-w-md space-y-8">
                <div>
                    <!-- Icon -->
                    <div
                        class="mx-auto mb-6 flex h-20 w-20 items-center justify-center rounded-2xl bg-gradient-to-br from-primary to-secondary p-4 shadow-lg shadow-primary/20">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-primary-content"
                            viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" />
                        </svg>
                    </div>
                    <h1 class="text-5xl font-black tracking-tight text-base-content drop-shadow-sm">Create Account</h1>
                    <p class="py-6 text-lg font-medium text-base-content/70">
                        Join us to track your favorite movies.
                    </p>

                </div>

                <div
                    class="card border border-base-content/10 bg-base-100/60 shadow-2xl backdrop-blur-md transition-all duration-300 hover:shadow-primary/10">
                    <div class="card-body p-8 space-y-6">
                        <!-- Primary Action: Google Sign In -->
                        <form method="POST">
                            <input type="hidden" name="provider" value="google">
                            <button
                                class="btn btn-primary btn-lg w-full gap-3 shadow-lg transition-all hover:scale-[1.02] hover:shadow-primary/30">
                                <svg class="h-6 w-6" viewBox="0 0 24 24">
                                    <path fill="currentColor"
                                        d="M21.35 11.1h-9.17v2.73h6.51c-.33 3.81-3.5 5.44-6.5 5.44C8.36 19.27 5 16.25 5 12c0-4.1 3.2-7.27 7.16-7.27 1.94 0 3.73.53 5.3 2.07l1.96-1.96C16.91 2.97 14.76 2 12.16 2 6.6 2 2.08 6.53 2.08 12.2S6.6 22.41 12.16 22.41c4.42 0 8.12-2.31 9.75-5.9 1.16-2.55 1.16-5.41.93-5.41z" />
                                </svg>
                                <span>Sign up with Google</span>
                            </button>
                        </form>

                        <!-- Divider -->
                        <div class="divider text-base-content/30 text-xs">or</div>

                        <!-- Secondary Actions -->
                        <div class="flex gap-3 justify-center">
                            <a href="/"
                                class="btn btn-ghost btn-sm gap-2 text-base-content/60 hover:text-base-content transition-all">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                                </svg>
                                <span>Back to Home</span>
                            </a>
                            <a href="/login"
                                class="btn btn-ghost btn-sm gap-2 text-primary hover:bg-primary/10 transition-all">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
                                </svg>
                                <span>Already have an account?</span>
                            </a>
                        </div>

                        <!-- Terms -->
                        <p class="text-center text-xs text-base-content/40 pt-2">
                            By signing up, you agree to our Terms of Service and Privacy Policy.
                        </p>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>