<script server>
    let error = null
    console.log('Processing request method:', request.method)
    if (request.method === 'POST') {
        const provider = body().provider
        console.log('Provider:', provider)
        if (provider) {
            try {
                // Disable autoRedirect so we can handle it explicitly
                const url = requestOAuth2Login(provider, {
                    redirectPath: '/auth/oauth/redirect',
                    autoRedirect: false
                })
                console.log('Redirecting to:', url)
                redirect(url)
            } catch (e) {
                console.error('Login error:', e)
                error = e.message
            }
        }
    }
</script>

<div class="relative min-h-[calc(100vh-64px)] overflow-hidden">
    <!-- Background Effects -->
    <div class="absolute inset-0 bg-gradient-to-br from-primary/10 via-base-100 to-secondary/10">
        <!-- Grid Pattern -->
        <div
            class="absolute inset-0 bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px]">
        </div>
        <!-- Radial Gradient Overlay -->
        <div class="absolute inset-0 bg-gradient-to-t from-base-100 via-base-100/50 to-transparent"></div>
        <!-- Cinematic Glow -->
        <div
            class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-primary/20 rounded-full blur-[120px] opacity-40 animate-pulse">
        </div>
    </div>

    <div class="hero relative z-10 min-h-[calc(100vh-64px)]">
        <div class="hero-content text-center">
            <div class="max-w-md space-y-8">
                <div>
                    <!-- Icon -->
                    <div
                        class="mx-auto mb-6 flex h-20 w-20 items-center justify-center rounded-2xl bg-gradient-to-br from-primary to-secondary p-4 shadow-lg shadow-primary/20">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-primary-content"
                            viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z" />
                        </svg>
                    </div>
                    <h1 class="text-5xl font-black tracking-tight text-base-content drop-shadow-sm">Welcome Back</h1>
                    <p class="py-6 text-lg font-medium text-base-content/70">
                        Sign in to curate your personal cinema journey.
                    </p>
                </div>

                <div
                    class="card border border-base-content/10 bg-base-100/60 shadow-2xl backdrop-blur-md transition-all duration-300 hover:shadow-primary/10">
                    <div class="card-body p-8">
                        <form method="POST" class="space-y-4">
                            <input type="hidden" name="provider" value="google">
                            <button
                                class="btn btn-primary btn-lg w-full gap-3 shadow-lg transition-transform hover:scale-[1.02]">
                                <svg class="h-6 w-6" viewBox="0 0 24 24">
                                    <path fill="currentColor"
                                        d="M21.35 11.1h-9.17v2.73h6.51c-.33 3.81-3.5 5.44-6.5 5.44C8.36 19.27 5 16.25 5 12c0-4.1 3.2-7.27 7.16-7.27 1.94 0 3.73.53 5.3 2.07l1.96-1.96C16.91 2.97 14.76 2 12.16 2 6.6 2 2.08 6.53 2.08 12.2S6.6 22.41 12.16 22.41c4.42 0 8.12-2.31 9.75-5.9 1.16-2.55 1.16-5.41.93-5.41z" />
                                </svg>
                                <span>Sign in with Google</span>
                            </button>
                        </form>
                        <div class="mt-4 text-center">
                            <p class="text-xs text-base-content/40">
                                By signing in, you agree to our Terms of Service and Privacy Policy.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>